\chapter{Implementasi dan Pengujian}
\label{chap:testing}

Bab ini akan membahas hal-hal mengenai implementasi kode perkakas, serta skenario-skenario pengujian yang akan digunakan dalam pengujian fungsional perkakas.

\section{Implementasi Kode}
\label{sec:testing-implementation}

\subsection{Implementasi Kode Utama}
\label{sec:testing-implementation-main}

Seperti yang dapat dilihat di bab sebelumnya, dalam dokumen skripsi ini, perkakas yang telah dibuat ini tidak mengikutkan sebuah diagram kelas. Hal ini dikarenakan perkakas \cl KIRI ini terdiri atas satu kelas saja, yang di dalamnya memiliki berbagai macam fungsi, yang masing-masingnya memiliki fungsi-fungsi tersendiri. Subbab ini akan menjelaskan kode tersebut secara singkat tetapi menyeluruh, mulai dari cara kerja perkakas secara garis besar, variabel-variabel global, serta tujuan dari tiap-tiap fungsi. Adapun kode lengkap dari perkakas dapat dilihat di Lampiran \ref{lamp:A}.
	
\begin{itemize}[listparindent=\parindent]
	\item Cara kerja perkakas \\
	Untuk setiap operasinya, perkakas \cl KIRI ini terdiri atas empat proses utama, dengan urutan operasi internal sebagai berikut.
	
	\begin{enumerate}
		\item Penerimaan opsi dan argumen \\
		Di proses ini, perkakas akan melakukan pengecekan paling dasar, yaitu mengecek apakah pengguna menggunakan opsi dan memasukkan argumennya dengan tepat atau tidak. \textit{Error checking} yang dilakukan di tahap ini juga hanya sebatas pengecekan dasar, seperti pengecekan validitas opsi yang digunakan, jumlah argumen yang dimasukkan, serta validitas mode operasi dari perkakas (opsi \verb|--mode|). Kesalahan apapun yang terdapat di hal-hal selain kedua aspek tersebut hanya akan ditandai.
		\item Verifikasi kebenaran opsi dan argumen \\
		Di proses ini, perkakas akan melakukan pengecekan lanjutan terhadap argumen-argumen yang dimasukkan pengguna. Jika ada argumen yang tidak valid, perkakas akan langsung berhenti dan mengeluarkan pesan \textit{error} yang sesuai.
		\item Pengiriman permintaan GET ke API serta penerimaan kembali respons\\
		Setelah semua opsi dan argumen yang dibutuhkan diverifikasi validitasnya, perkakas akan membangun URL yang diperlukan untuk permintaan GET ke API, dan melakukan permintaan tersebut melalui cURL. \textit{Library} cURL ini nantinya juga adalah \textit{library} yang memfasilitasi penerimaan kembali respons dari API.
		\item Verifikasi akhir respons API \\
		Terakhir, isi dari respons API akan diperiksa. Segala abnormalitas yang terdapat di dalam isi respons tersebut akan ditangani langsung oleh perkakas dalam bentuk pesan-pesan \textit{error} untuk tiap kasusnya.
	\end{enumerate}
	
	\item Variabel global \\
	Perkakas ini memiliki beberapa variabel global, seperti yang dapat dilihat di kode \ref{code:kiritool-global-vars}. Variabel-variabel ini sengaja diletakkan sebagai variabel global, karena variabel-variabel ini digunakan di hampir keseluruhan dari keempat proses di bagian sebelumnya. Adapun variabel-variabel ini adalah sebagai berikut:
	
	\begin{itemize}
		\item \verb|chunk| (\verb|struct|) \\
		Struktur dari respons API KIRI. Struktur ini memiliki dua variabel, yaitu \verb|data|, yang akan berisi datanya sendiri, serta \verb|size|, yang merupakan ukuran dari data dalam respons.
		\item \verb|responsedata| (\verb|chunk|) \\
		Akan diisi respons dari API KIRI.
		\item \verb|responseJSON| (\verb|cJSON|) \\
		Berisi hasil konversi JSON dari respons API yang dapat dibaca oleh perkakas dan utilitas-utilitas \textit{library} cJSON.
		\item \verb|URL| (\verb|char[]|) \\
		Basis dari URL yang akan digunakan sebagai URL permintaan GET ke API. Awalnya variabel ini akan berisi ``\verb|https://projectkiri.id/api?version=2|''\textemdash bagian ini tidak akan berubah bagaimanapun permintaan GET-nya.
		\item \verb|mode| (\verb|int|) \\
		Kode operasional perkakas berupa bilangan bulat. Bilangan ini memiliki rentang dari -1 hingga 4, di mana arti dari tiap bilangan dapat dilihat di komentar di potongan kode.
		\item \verb|region| (\verb|int|) \\
		Kode region berupa bilangan bulat untuk mode \verb|searchplace|. Bilangan ini memiliki rentang dari -1 hingga 4, di mana arti dari tiap bilangan dapat dilihat di komentar di potongan kode.
		\item \verb|query| (\verb|char[]|) \\
		\textit{String} (berupa \textit{array} karakter) yang menyimpan kata kunci pencarian lokasi untuk mode \verb|searchplace|.
		\item \verb|start| (\verb|char[]|) \\
		\textit{String} (berupa \textit{array} karakter) yang menyimpan koordinat lokasi awal (\verb|findroute|) atau kata kunci pencarian lokasi awal (\verb|direct|).
		\item \verb|finish| (\verb|char[]|) \\
		\textit{String} (berupa \textit{array} karakter) yang menyimpan koordinat lokasi akhir (\verb|findroute|) atau kata kunci pencarian lokasi akhir (\verb|direct|).
		\item \verb|escape| (\verb|char[]|) \\
		Variabel ini dibutuhkan karena pengkodean URL (untuk permintaan GET) tidak mendukung karakter spasi (` '), melainkan ``\verb|%20|''. \textit{String} yang karakter spasinya sudah diganti dengan ``\verb|%20|'' akan disimpan sementara di variabel ini, sebelum isinya disalin kembali ke variabel awalnya.
		\item \verb|regstart| (\verb|int|) \\
		Kode region lokasi awal berupa bilangan bulat untuk mode \verb|direct|. Bilangan ini memiliki rentang dari -1 hingga 4, di mana arti dari tiap bilangan dapat dilihat di komentar di potongan kode.
		\item \verb|regfinish| (\verb|int|) \\
		Kode region lokasi akhir berupa bilangan bulat untuk mode \verb|direct|. Bilangan ini memiliki rentang dari -1 hingga 4, di mana arti dari tiap bilangan dapat dilihat di komentar di potongan kode.
		\item \verb|locale| (\verb|int|) \\
		Kode bahasa berupa bilangan bulat. Bilangan ini memiliki rentang dari 0 hingga 2, di mana arti dari tiap bilangan dapat dilihat di komentar di potongan kode. Variabel ini juga merupakan satu-satunya variabel kode \textit{integer} yang nilai awalnya (jika tidak diubah) tidak akan menyebabkan \textit{error}.
		\item \verb|step| (\verb|int|) \\
		Kode khusus untuk mode \verb|direct| yang menandakan proses mana yang sedang berlangsung\textemdash pencarian lokasi awal, pencarian lokasi akhir, atau pencarian rute.
		\item \verb|error| (\verb|int|) \\
		Kode yang menandakan apakah sebuah \textit{error} telah terjadi. Nilai awal dari variabel ini adalah 0, dan jika variabel ini diganti menjadi 1, di pengecekan kode \textit{error} selanjutnya, perkakas akan dihentikan.
	\end{itemize}
	\noindent
	Potongan kode dalam file \verb|main.c| yang menunjukkan variabel-variabel global dari perkakas dapat dilihat di kode \ref{code:kiritool-global-vars}.
	
	\begin{lstlisting}[language=C, caption=Variabel global perkakas \cl KIRI, label=code:kiritool-global-vars]
struct chunk {
    char *data;
    size_t size;
};
struct chunk responsedata; // Incoming data chunks

cJSON *responseJSON;
char URL[1000] = "https://projectkiri.id/api?version=2";
int mode = -1; // -1 = undefined, 0 = unknown, 1 = help, 2 = searchplace, 3 = findroute, 4 = direct
int region = -1; // -1 = undefined, 0 = unknown, 1 = cgk, 2 = bdo, 3 = mlg, 4 = sub
char query[100];
char start[100];
char finish[100];
char escape[100]; // Temporary variable for escaping string inputs
int regstart = -1; // -1 = undefined, 0 = unknown, 1 = cgk, 2 = bdo, 3 = mlg, 4 = sub
int regfinish = -1; // -1 = undefined, 0 = unknown, 1 = cgk, 2 = bdo, 3 = mlg, 4 = sub
int locale = 0; // 0 = id, 1 = en, 2 = unknown
int step; // 0 = search starting location, 1 = search finish location, 2 = find route
// Used only in multistep modes
// 1 = an error has occurred, otherwise 0
int error = 0; 
	\end{lstlisting}
	
	\item Fungsi \verb|print_help()| \\
	Fungsi ini merupakan fungsi yang akan dipanggil ketika pengguna memilih opsi standar \verb|--help|. Fungsi ini akan mengeluarkan bantuan singkat cara penggunaan perkakas. Implementasi dari fungsi ini dapat dilihat di potongan kode \ref{code:kiritool-function-help}.
	
	\begin{lstlisting}[language=C, caption=Implementasi fungsi print\textunderscore help(), label=code:kiritool-function-help]
void print_help() {
    puts("KIRI Command Line Tool, version 1.2.12");
    puts("Use the KIRI tool through the command line.");
    putchar('\n');
    puts("USAGE:");
    puts("    kiritool <COMMAND> [OPTIONS...] [<ARGUMENTS>]");
    putchar('\n');
    puts("COMMAND:");
    puts("    -h, --help          Display usage tutorial.");
    puts("    -m, --mode <MODE>   Set the tool operation mode.\n");
    puts("    You can only choose one mode per operation.");
    putchar('\n');
    puts("OPTIONS:");
    puts("    -F, --regfinish <REGION>    Set region to search for finish location in.");
    puts("    -f, --finish <FINISH>       Set finish location.");
    puts("    -l, --locale <LANG>         Set tool output language.");
    puts("    -q, --query <KEYWORD>       Set keyword for searching.");
    puts("    -r, --region <REGION>       Set region to search for location in.");
    puts("    -S, --regstart <REGION>     Set region to search for starting location in.");
    puts("    -s, --start <START>         Set starting location.");
    putchar('\n');
    puts("ARGUMENTS:");
    puts("    <FINISH>");
    puts("        Route finish location.");
    puts("        For 'findroute' mode, input the location's latitude and longitude coordinates.");
    puts("        For 'direct' mode, input the location's search keyword (<KEYWORD> argument).");
    puts("    <KEYWORD>");
    puts("        Keywords used by the tool to search for the desired location.");
    puts("        For multiple words queries, encase the keywords in quotation marks (\" \").");
    puts("    <LANG>");
    puts("        Tool output language.");
    puts("        Available languages: id, en");
    puts("          - id (Indonesian - Default)");
    puts("          - en (English)");
    puts("    <MODE>");
    puts("        Tool operation mode. Note that not all options are needed for all modes.");
    puts("        Should the user input extra options, they will simply not be used.");
    puts("        Available modes:");
    puts("          - searchplace");
    puts("                Required options: --query, --region");
    puts("                Optional options: --locale");
    puts("          - findroute");   
    puts("                Required options: --start, --finish");
    puts("                Optional options: --locale");
    puts("          - direct");   
    puts("                Required options: --regstart, --start, --regfinish, --finish");
    puts("                Optional options: --locale");
    puts("    <REGION>");
    puts("        Region to search for locations in.");
    puts("        Available regions:");
    puts("          - cgk (Jakarta)");
    puts("          - bdo (Bandung)");
    puts("          - mlg (Malang)");
    puts("          - sub (Surabaya)");
    puts("    <START>");
    puts("        Route starting location.");
    puts("        For 'findroute' mode, input the location's latitude and longitude coordinates.");
    puts("        For 'direct' mode, input the location's search keyword (<KEYWORD> argument).");
}
	\end{lstlisting}
	
	\item Fungsi \verb|replace_space()| \\
	Fungsi ini merupakan fungsi yang berfungsi untuk mengganti semua karakter spasi (` ') dalam variabel-variabel kata kunci pencarian sebelum isi dari variabel-variabel tersebut dimasukkan ke dalam URL untuk permintaan GET. Implementasi dari fungsi ini dapat dilihat di potongan kode \ref{code:kiritool-function-spaceescape}.
	
	\begin{lstlisting}[language=C, caption=Implementasi fungsi print\textunderscore help(), label=code:kiritool-function-spaceescape]
void replace_space(char* string) {
    // Escapes all whitespace characters in string
    int i;
    int j = 0;

    for (i = 0; i < 100; i++) {
        if (string[i] == '\0') {
            break;
        }

        if (string[i] == ' ') {
            escape[j] = '%';
            escape[j + 1] = '2';
            escape[j + 2] = '0';
            j = j + 2;
        }
        else escape[j] = string[i];

        j++;
    }
}
	\end{lstlisting}
	
	\item Fungsi \verb|build_url_searchplace(region, query)| \\
	Fungsi ini merupakan fungsi yang digunakan untuk pembangunan URL permintaan	GET untuk proses pencarian lokasi. Fungsi ini menerima dua variabel, yaitu \verb|region| dan \verb|query|, yang keduanya dapat diatur berdasarkan proses pencarian lokasi untuk fitur mana yang sedang dilakukan. 
	
	Selain itu, fitur ini juga memiliki implementasi tambahan yang tidak ada di API KIRI, yaitu implementasi variabel \verb|locale| untuk mode \verb|searchplace|, yang memungkinkan pemilihan bahasa Indonesia atau Inggris untuk keluaran serta pesan-pesan \textit{error} yang berhubungan dengan mode tersebut. Adapun implementasi dari fungsi ini dapat dilihat di potongan kode \ref{code:kiritool-function-buildurl-searchplace}.
	
	\begin{lstlisting}[language=C, caption=Implementasi fungsi build\textunderscore url\textunderscore searchplace(), label=code:kiritool-function-buildurl-searchplace]
	void build_url_searchplace(int region, char* query) {
    strcat(URL, "&mode=searchplace");

    // Locale check - tool adition
    if (locale == 2) {
        error = 1;
        fputs("\nError:\n", stderr);
        fputs("Anda telah memasukkan pilihan bahasa (locale) yang tidak valid.\n", stderr);
        fputs("Mohon periksa kembali apakah pilihan bahasa yang anda masukkan valid atau tidak.\n", stderr);
        fputs("Pilihan locale: id, en\n", stderr);
        fputs("--------------------\n", stderr);
        fputs("You have inputted an invalid language (locale) option.\n", stderr);
        fputs("Please recheck whether the language code you inserted was supported or not.\n", stderr);
        fputs("Locale available: id, en\n", stderr);
        exit(0);
    }

    // Region check
    switch (region) {
        case -1:
            error = 1;
            fputs("\nError:\n", stderr);

            if (locale == 1) {
                fputs("Location searching requires a region to be set.\n", stderr);
                fputs("Please make sure you have chosen between one of the four available regions.\n", stderr);
                fputs("Regions available: cgk, bdo, mlg, sub\n", stderr);
            }
            else {
                fputs("Fitur pencarian lokasi memerlukan pengaturan region lokasi yang ingin dicari.\n", stderr);
                fputs("Mohon pastikan anda sudah memasukkan salah satu dari empat kode region yang tersedia.\n", stderr);
                fputs("Pilihan region: cgk, bdo, mlg, sub\n", stderr);
            }
            exit(0);
            break;
        
        case 1:
            strcat(URL, "&region=cgk");
            break;
        
        case 2:
            strcat(URL, "&region=bdo");
            break;
        
        case 3:
            strcat(URL, "&region=mlg");
            break;
        
        case 4:
            strcat(URL, "&region=sub");
            break;

        default:
            error = 1;
            fputs("\nError:\n", stderr);

            if (locale == 1) {
                fputs("You have inputted an invalid region.\n", stderr);
                fputs("Please recheck whether the region code chosen was one of the four region codes supported.\n", stderr);
                fputs("Regions available: cgk, bdo, mlg, sub\n", stderr);
            }
            else {
                fputs("Anda telah memasukkan region yang tidak valid.\n", stderr);
                fputs("Mohon periksa kembali apakah kode region yang anda masukkan merupakan salah satu dari empat kode region yang tersedia.\n", stderr);
                fputs("Pilihan region: cgk, bdo, mlg, sub\n", stderr);
            }
            exit(0);
            break;
    }

    // Query check
    if (strcmp(query, "\0") == 0) {
        error = 1;
        fputs("\nError:\n", stderr);

        if (locale == 1) {
            fputs("Location searching requires a search query.\n", stderr);
            fputs("Please make sure you have inputted a query to be used in the search.\n", stderr);
        }
        else {
            fputs("Fitur pencarian lokasi memerlukan sebuah kata kunci pencarian.\n", stderr);
            fputs("Mohon pastikan anda sudah memasukkan kata kunci untuk melakukan pencarian lokasi.\n", stderr);
        }
        exit(0);
    }
    else {
        strcat(URL, "&querystring=");
        strcat(URL, query);
    }
    strcat(URL, "&apikey=68CD281C8A8EE97C");
}
	\end{lstlisting}
	
	\item Fungsi \verb|build_url_findroute(locale, start, finish)| \\
	Fungsi ini merupakan fungsi yang digunakan untuk pembangunan URL permintaan	GET untuk proses pencarian rute angkot. Fungsi ini menerima tiga variabel, yaitu \verb|locale|, \verb|start|, dan \verb|finish|. Adapun implementasi dari fungsi ini dapat dilihat di potongan kode \ref{code:kiritool-function-buildurl-findroute}.
	
	\begin{lstlisting}[language=C, caption=Implementasi fungsi build\textunderscore url\textunderscore findroute(), label=code:kiritool-function-buildurl-findroute]
void build_url_findroute(int locale, char* start, char* finish) {
    strcat(URL, "&mode=findroute");

    // Locale check
    switch (locale) {
        case 1:
            strcat(URL, "&locale=en");
            break;
        
        case 2:
            error = 1;
            fputs("\nError:\n", stderr);
            fputs("Anda telah memasukkan pilihan bahasa (locale) yang tidak valid.\n", stderr);
            fputs("Mohon periksa kembali apakah pilihan bahasa yang anda masukkan valid atau tidak.\n", stderr);
            fputs("Pilihan locale: id, en\n", stderr);
            fputs("--------------------\n", stderr);
            fputs("You have inputted an invalid language (locale) option.\n", stderr);
            fputs("Please recheck whether the language code you inserted was supported or not.\n", stderr);
            fputs("Locale available: id, en\n", stderr);
            exit(0);
            break;
        
        default:
            strcat(URL, "&locale=id");
            break;
    }

    // Starting location check
    if (strcmp(start, "\0") == 0) {
        error = 1;
        fputs("\nError:\n", stderr);

        if (locale == 1) {
            fputs("You did not input the coordinates of the starting location.\n", stderr);
            fputs("Please input the coordinates of the starting location through the corresponding option.\n", stderr);
        }
        else {
            fputs("Anda belum memasukkan sebuah koordinat untuk lokasi awal.\n", stderr);
            fputs("Mohon masukkan koordinat untuk lokasi awal pencarian rute melalui opsi yang sesuai.\n", stderr);
        }
        exit(0);
    }
    else {
        strcat(URL, "&start=");
        strcat(URL, start);
    }

    // End location check
    if (strcmp(finish, "\0") == 0) {
        error = 1;
        fputs("\nError:\n", stderr);

        if (locale == 1) {
            fputs("You did not input the coordinates of the end location.\n", stderr);
            fputs("Please input the coordinates of the end location through the corresponding option.\n", stderr);
        }
        else {
            fputs("Anda belum memasukkan sebuah koordinat untuk lokasi akhir.\n", stderr);
            fputs("Mohon masukkan koordinat untuk lokasi akhir pencarian rute melalui opsi yang sesuai.\n", stderr);
        }
        exit(0);
    }
    else {
        strcat(URL, "&finish=");
        strcat(URL, finish);
    }

    strcat(URL, "&presentation=desktop");
    strcat(URL, "&apikey=68CD281C8A8EE97C");
}
	\end{lstlisting}
	
	\item Fungsi \verb|reset_url()| \\
	Fungsi ini digunakan untuk mengembalikan isi dari variabel \verb|URL| ke nilai semula. Fungsi ini akan dipanggil hanya di fitur \verb|direct|, dan hanya di saat pergantian proses dalam fitur tersebut, dengan asumsi bahwa tidak ada \textit{error} yang terjadi di langkah sebelumnya. Implementasi dari fungsi ini dapat dilihat di potongan kode \ref{code:kiritool-function-buildurl-reset}.
	
	\begin{lstlisting}[language=C, caption=Implementasi fungsi reset\textunderscore url(), label=code:kiritool-function-buildurl-reset]
void reset_url() {
    // Reset URL for multiple API processes at once
    strcpy(URL, "https://projectkiri.id/api?version=2");
}
	\end{lstlisting}
	
	\item Fungsi \verb|execute_curl()| \\
	Fungsi ini digunakan untuk proses pengiriman permintaan ke API, serta penerimaan respons dari API. Semua utilitas dari library cURL yang dipakai dalam perkakas ini diimplementasikan hanya di dalam fungsi ini. Adapun implementasi dari fungsi ini dapat dilihat di potongan kode \ref{code:kiritool-function-curl-execute}.
	
	\begin{lstlisting}[language=C, caption=Implementasi fungsi execute\textunderscore curl(), label=code:kiritool-function-curl-execute]
void execute_curl() {
    CURL *curl;
    CURLcode response;
    memset(&responsedata, 0, sizeof(responsedata)); // Empty response data chunk for multiprocess modes

    curl_global_init(CURL_GLOBAL_DEFAULT);
    curl = curl_easy_init();

    if (curl) {
        curl_easy_setopt(curl, CURLOPT_URL, URL);
        curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_memalloc);
        curl_easy_setopt(curl, CURLOPT_WRITEDATA, (void *)&responsedata);
        response = curl_easy_perform(curl);
        if (response != CURLE_OK) {
            print_curl_error();
        }

        switch (mode) {
            case 2: // searchplace
                write_searchplace();
                break;
            
            case 3: // findroute
                write_findroute();
                break;

            case 4: // directroute
                if (step == 0 || step == 1) { // search start and finish
                    write_searchplace_noreturns();
                }
                else if (step == 2) { // findroute
                    write_findroute();
                }
                break;

            default:
                break;
        }

        curl_easy_cleanup(curl);
    }

    curl_global_cleanup();
}
	\end{lstlisting}
	
	\item Fungsi \verb|print_curl_error()| \\
	Fungsi ini merupakan fungsi sederhana yang akan mengeluarkan pesan \textit{error} apabila terjadi \textit{error} koneksi ketika perkakas ingin melakukan komunikasi dengan API KIRI. Implementasi dari fungsi ini tertera di potongan kode \ref{code:kiritool-function-curl-error}.
	
	\begin{lstlisting}[language=C, caption=Implementasi fungsi print\textunderscore curl\textunderscore error(), label=code:kiritool-function-curl-error]
void print_curl_error() {
    error = 1;
    fputs("\nError:\n", stderr);

    if (locale == 1) {
        fputs("A connection error has occurred.\n", stderr);
        fputs("Please verify whether the internet connection is up and running.\n", stderr);
    }
    else {
        fputs("Telah terjadi error koneksi.\n", stderr);
        fputs("Mohon cek apakah koneksi internet aktif dan terhubung dengan baik.\n", stderr);
    }
}
	\end{lstlisting}
	
	\item Fungsi \verb|write_memalloc()| \\
	Fungsi ini adalah fungsi tambahan untuk cURL yang bertugas menerima data yang masuk dari API. Di fungsi ini juga diimplementasikan sebuah fitur pengalokasian memori untuk menghindari terjadinya \textit{error} akibat data yang diterima melebihi alokasi memori yang diperbolehkan oleh nilai ukuran memori \textit{default}-nya. Implementasi dari fungsi ini tertera di potongan kode \ref{code:kiritool-function-write-memalloc}.
	
	\begin{lstlisting}[language=C, caption=Implementasi fungsi write\textunderscore memalloc(), label=code:kiritool-function-write-memalloc]
// Allocate the memory of incoming data
// If data size + original allocated size exceeds the memory capability, print an error.
size_t write_memalloc(void *incomingdata, size_t size, size_t nmemb, void *userdata) {
    size_t realsize = size * nmemb;
    struct chunk *memory = (struct chunk *)userdata;
    char *ptr = realloc(memory->data, memory->size + realsize + 1);
    if(ptr == NULL) {
        fprintf(stderr, "Out of memory!\n");
        return 0;
    } 
    memory->data = ptr;
    memcpy(&(memory->data[memory->size]), incomingdata, realsize);
    memory->size += realsize;
    memory->data[memory->size] = 0;

    return realsize;
}
	\end{lstlisting}
	
	\item Fungsi \verb|write_searchplace()| \\
	Fungsi ini adalah fungsi yang bertugas untuk memproses respons dari API untuk fitur pencarian lokasi dari mode \verb|searchplace|. Fungsi ini akan langsung menampilkan keluaran akhir, atau jika terjadi \textit{error}, maka fitur ini akan menampilkan pesan \textit{error} yang sesuai. Adapun implementasi dari fungsi ini dapat dilihat di potongan \ref{code:kiritool-function-write-search}.
	
	\begin{lstlisting}[language=C, caption=Implementasi fungsi write\textunderscore seachplace(), label=code:kiritool-function-write-search]
void write_searchplace() {
    cJSON *status;
    cJSON *result;
    cJSON *resultitem;
    cJSON *resultitemname;
    cJSON *resultitemlocation;
    int indexitem;

    responseJSON = cJSON_Parse(responsedata.data);
    status = cJSON_GetObjectItem(responseJSON, "status");
    
    // Check whether API returned an error
    if (strcmp(status->valuestring, "ok") != 0) {
        error = 1;
        fputs("\nError:\n", stderr);

        if (locale == 1) {
            fputs("API returned an error as its output.\n", stderr);
            fputs("Please recheck whether the query was formatted correctly.\n", stderr);
        }
        else {
            fputs("API mengembalikan error sebagai keluarannya.\n", stderr);
            fputs("Silakan cek ulang apakah kata kunci pencarian sudah diformat dengan benar.\n", stderr);
        }
    }
    else {
        result = cJSON_GetObjectItem(responseJSON, "searchresult");

        // Check whether API managed to find a single result
        if (cJSON_GetArraySize(result) == 0) {
            error = 1;
            fputs("\n", stderr);

            if (locale == 1) {
                fputs("Location not found.\n", stderr);
                fputs("Please recheck whether the search keyword was inputted correctly.\n", stderr);
            }
            else {
                fputs("Lokasi tidak berhasil ditemukan.\n", stderr);
                fputs("Silakan cek ulang apakah kata kunci pencarian sudah dimasukkan dengan benar.\n", stderr);
            }
        }
        else {
            indexitem = 1;
            
            cJSON_ArrayForEach(resultitem, result) {
                resultitemname = cJSON_GetObjectItem(resultitem, "placename");
                resultitemlocation = cJSON_GetObjectItem(resultitem, "location");

                // Print location index only if there were more than one found
                if (cJSON_GetArraySize(result) > 1) {
                    if (locale == 1) {
                        printf("Location %d:\n", indexitem);
                    }
                    else printf("Lokasi %d:\n", indexitem);
                }
                else {
                    if (locale == 1) {
                        puts("Location:");
                    }
                    else puts("Lokasi:");
                }
                puts("--------------------");

                if (locale == 1) {
                    printf("Name: %s\n", resultitemname->valuestring);
                    printf("Coordinates: %s\n", resultitemlocation->valuestring);
                }
                else {
                    printf("Nama: %s\n", resultitemname->valuestring);
                    printf("Koordinat: %s\n", resultitemlocation->valuestring);
                }
                putchar('\n');

                indexitem++;
            }
        }
    }
}
	\end{lstlisting}
	
	\item Fungsi \verb|write_findroute()| \\
	Fungsi ini adalah fungsi yang bertugas untuk memproses respons dari API untuk fitur pencarian rute angkot. Fungsi ini akan langsung menampilkan keluaran akhir, atau jika terjadi \textit{error}, maka fitur ini akan menampilkan pesan \textit{error} yang sesuai. Adapun implementasi dari fungsi ini dapat dilihat di potongan \ref{code:kiritool-function-write-findroute}.
	
	\begin{lstlisting}[language=C, caption=Implementasi fungsi write\textunderscore findroute(), label=code:kiritool-function-write-findroute]
void write_findroute() {
    cJSON *status;
    cJSON *result;
    cJSON *route;
    cJSON *routesteps;
    cJSON *routetime;
    cJSON *routestepitem;
    cJSON *routestepdetail;
    char routetimestring[20]; // Store translated duration string
    char *routetimetemp;
    char *timearraytoken;
    int indexroute;
    int indexstep;

    responseJSON = cJSON_Parse(responsedata.data);
    status = cJSON_GetObjectItem(responseJSON, "status");

    // Check whether API returned an error
    if (strcmp(status->valuestring, "ok") != 0) {
        error = 1;
        fputs("\nError:\n", stderr);

        if (locale == 1) {
            fputs("API returned an error as its output.\n", stderr);
            fputs("Please recheck whether both location's coordinates were inputted correctly.\n", stderr);
        }
        else {
            fputs("API mengembalikan error sebagai keluarannya.\n", stderr);
            fputs("Silakan cek ulang apakah koordinat kedua lokasi sudah dimasukkan dengan benar.\n", stderr);
        }
    }
    else {
        result = cJSON_GetObjectItem(responseJSON, "routingresults");
        indexroute = 1;

        // For each possible routes...
        cJSON_ArrayForEach(route, result) {
            routesteps = cJSON_GetObjectItem(route, "steps");
            routetime = cJSON_GetObjectItem(route, "traveltime");

            if (mode == 4 && indexroute == 1) {
                putchar('\n');
            }

            // Check whether API managed to find a single result
            if (cJSON_IsNull(routetime)) {
                error = 1;
                fputs("\n", stderr);

                if (locale == 1) {
                    fputs("Sorry, we couldn't find a public transport route for your trip.\n", stderr);
                }
                else fputs("Maaf, kami tidak dapat menemukan rute transportasi publik untuk perjalanan anda.\n", stderr);
            }
            else {
                routetimetemp = routetime->valuestring;
                memset(routetimestring, 0, sizeof(routetimestring));
                indexstep = 1;

                // Fix bug from KIRI API in which "minute" time unit is not translated in id
                // Else skip whole process
                if (locale != 1) {
                    timearraytoken = strtok(routetimetemp, " ");

                    while (timearraytoken != NULL) {
                        if (strcmp(timearraytoken, "minutes") == 0) {
                            strcpy(timearraytoken, "menit");
                        }
                        strcat(routetimestring, timearraytoken);
                        strcat(routetimestring, " ");

                        timearraytoken = strtok(NULL, " ");
                    }
                }
                else strcpy(routetimestring, routetimetemp);

                // Print route index only if there were more than one found
                // Otherwise simply print "Route:"
                if (cJSON_GetArraySize(result) > 1) {
                    if (locale == 1) {
                        printf("Route %d:\n", indexroute);
                    }
                    else printf("Rute %d:\n", indexroute);
                }
                else {
                    if (locale == 1) {
                        puts("Route:");
                    }
                    else puts("Rute:");
                }
                puts("--------------------");
                
                if (locale == 1) {
                    printf("Estimated duration: %s\n", routetimestring);
                }
                else printf("Estimasi waktu: %s\n", routetimestring);
                puts("--------------------");
                
                cJSON_ArrayForEach(routestepitem, routesteps) {
                    routestepdetail = cJSON_GetArrayItem(routestepitem, 3);

                    if (locale == 1) {
                        printf("Step %d: ", indexstep);
                    }
                    else printf("Langkah %d: ", indexstep);
                    printf("%s\n", routestepdetail->valuestring);
                    indexstep++;
                }
            }
            if (error != 1) {
                putchar('\n');
            };

            indexroute++;
        }
    }
}
	\end{lstlisting}
	
	\item Fungsi \verb|write_searchplace_noreturns()| \\
	Fungsi ini adalah fungsi yang bertugas untuk memproses respons dari API untuk fitur pencarian lokasi dari mode \verb|direct|. Berbeda dengan fungsi \verb|searchplace| sebelumnya, fungsi ini hanya akan menampilkan nama lokasi (awal dan/atau akhir), atau jika terjadi \textit{error} di salah satu prosesnya, maka fitur ini akan menampilkan pesan \textit{error} yang sesuai. Adapun implementasi dari fungsi ini dapat dilihat di potongan \ref{code:kiritool-function-write-searchdirect}.
	
	\begin{lstlisting}[language=C, caption=Implementasi fungsi write\textunderscore searchplace\textunderscore noreturns(), label=code:kiritool-function-write-searchdirect]
void write_searchplace_noreturns() {
    cJSON *status;
    cJSON *result;
    cJSON *resultitem;
    cJSON *resultitemname;
    cJSON *resultitemlocation;

    responseJSON = cJSON_Parse(responsedata.data);
    status = cJSON_GetObjectItem(responseJSON, "status");
    
    // Check whether API returned an error
    if (strcmp(status->valuestring, "ok") != 0) {
        error = 1;
        fputs("\nError:\n", stderr);
        
        if (step == 0) {
            if (locale == 1) {
                fputs("API returned an error as its start coordinates.\n", stderr);
                fputs("Please recheck whether the starting location coordinates were inputted correctly.\n", stderr);
            }
            else {
                fputs("API mengembalikan error sebagai koordinat lokasi awal.\n", stderr);
                fputs("Silakan cek ulang apakah koordinat lokasi awal sudah dimasukkan dengan benar.\n", stderr);
            }
        }
        else if (step == 1) {
            if (locale == 1) {
                fputs("API returned an error as its end coordinates.\n", stderr);
                fputs("Please recheck whether the end location coordinates were inputted correctly.\n", stderr);
            }
            else {
                fputs("API mengembalikan error sebagai koordinat lokasi akhir.\n", stderr);
                fputs("Silakan cek ulang apakah koordinat lokasi akhir sudah dimasukkan dengan benar.\n", stderr);
            }
        }
    }
    else {
        result = cJSON_GetObjectItem(responseJSON, "searchresult");

        // Check whether API managed to find a single result
        if (cJSON_GetArraySize(result) == 0) {
            error = 1;
            fputs("\n", stderr);
            
            if (step == 0) {
                if (locale == 1) {
                    fputs("Starting location not found.\n", stderr);
                    fputs("Please recheck whether the search keyword was inputted correctly.\n", stderr);
                }
                else {
                    fputs("Lokasi awal tidak berhasil ditemukan.\n", stderr);
                    fputs("Silakan cek ulang apakah kata kunci pencarian sudah dimasukkan dengan benar.\n", stderr);
                }
            }
            else if (step == 1) {
                if (locale == 1) {
                    fputs("Finish location not found.\n", stderr);
                    fputs("Please recheck whether the search keyword was inputted correctly.\n", stderr);
                }
                else {
                    fputs("Lokasi akhir tidak berhasil ditemukan.\n", stderr);
                    fputs("Silakan cek ulang apakah kata kunci pencarian sudah dimasukkan dengan benar.\n", stderr);
                }
            }
        }
        else {
            // Direct route mode only supports first location found
            resultitem = cJSON_GetArrayItem(result, 0);
            resultitemname = cJSON_GetObjectItem(resultitem, "placename");
            resultitemlocation = cJSON_GetObjectItem(resultitem, "location");

            if (step == 0) {
                if (locale == 1) {
                    printf("Starting location: %s\n", resultitemname->valuestring);
                }
                else printf("Lokasi awal: %s\n", resultitemname->valuestring);
                strcpy(start, resultitemlocation->valuestring);
            }
            else if (step == 1) {
                if (locale == 1) {
                    printf("Finish location: %s\n", resultitemname->valuestring);
                }
                else printf("Lokasi akhir: %s\n", resultitemname->valuestring);
                strcpy(finish, resultitemlocation->valuestring);
            }
        }
    }
}
	\end{lstlisting}
	
	
\end{itemize}

\subsection{Implementasi CMake}
\label{sec:testing-implementation-cmake}

\section{Pengujian}
\label{sec:testing-experiments}

Bagian ini akan menjelaskan hal-hal yang seputar pengujian perkakas yang telah dibuat\textemdash lingkungan pengujian, cara instalasi dan penggunaan perkakas, serta pengujian fungsional melalui berbagai macam kasus tes (\textit{test case}).

\subsection{Lingkungan Perangkat Keras}
\label{sec:testing-experiments-hardware}

Berikut merupakan spesifikasi perangkat keras yang digunakan dalam pembangunan perkakas ini:

\begin{itemize}
	\item \textit{Processor}: Intel\logoregistered\xspace Core\logotrademark\xspace i5-10300H @ 2.50 GHz
	\item RAM: 8 GB
	\item \textit{Hard disk}: SSD 512 GB (NVMe\logotrademark\xspace M.2)
	\item Perangkat keras pendukung: Keyboard
\end{itemize}

\subsection{Lingkungan Perangkat Lunak}
\label{sec:testing-experiments-software}

Berikut merupakan spesifikasi perangkat lunak yang digunakan dalam pembangunan perkakas ini:

\begin{itemize}
	\item Windows:
	
	\begin{itemize}
		\item OS: Windows 10 Home Single Language (64-bit)
		\item \textit{Compiler}: MinGW (GNU\textemdash versi 12.1.0)
		\item \textit{Library}:
		
		\begin{itemize}
			\item curl (versi 7.83.1)
			\item cmake (versi 3.24.1)
		\end{itemize}
		
	\end{itemize}
	
	\item Linux:
	
	\begin{itemize}
		\item OS: Ubuntu Jammy (22.04)
		\item \textit{Compiler}: MinGW (GNU\textemdash versi 12.1.0)
		\item \textit{Library}:
		
		\begin{itemize}
			\item curl (versi 7.81.0)
			\item cmake (versi 3.22.1)
		\end{itemize}
		
	\end{itemize}
	
\end{itemize}

\subsection{Instalasi dan Pembangunan}
\label{sec:testing-implementation-usage}

\subsubsection{Instalasi}
\label{sec:testing-implementation-usage-instalation}

Proses instalasi dari perkakas ini memiliki garis besar yang sama - instal \textit{compiler} C, kemudian instal \textit{library yang diperlukan}. Karena banyaknya perbedaan dari detil yang perlu dilakukan untuk setiap sistem operasi, maka bagian ini akan dibagi dua, menjadi satu bagian per sistem operasi.

\begin{itemize}
	\item Windows \\
	Untuk sistem operasi Windows, pengguna perlu menginstal hal-hal berikut:
	
	\begin{itemize}
		\item vcpkg
		\item cURL
		\item CMake
	\end{itemize}
	
	Perlu diperhatikan bahwa cURL (di Windows) harus diinstal melalui vcpkg\textemdash cURL bawaan dari Windows tidak mengandung \textit{library-library development} sekunder yang dibutuhkan oleh perkakas ini. Di lain hal, instalasi cURL secara manual hanya memungkinkan perkakas cURL-nya sendiri untuk diakses dari mana saja (melalui variabel \textit{environment}), tetapi hal ini tidak berlaku untuk \textit{library development} sekundernya.
	
	\item Linux \\
	Untuk sistem operasi berbasis Linux, pengguna perlu menginstal hal-hal berikut:
	
	\begin{itemize}
		\item cURL
		\item CMake
		\item libcurl4-openssl-dev (\textit{library development} cURL)
		\item GNU Make
	\end{itemize}
	
\end{itemize}

Ingat bahwa perkakas ini juga menggunakan \textit{library} cJSON, tetapi untuk alasan kompatibilitas antar Windows dan Linux, \textit{library} ini langsung diikutkan di dalam perkakasnya sendiri, sehingga tidak perlu diinstal oleh pengguna lagi.

% Old version
\begin{comment}
Untuk dapat menjalankan perkakas ini, pengguna harus menginstal sebuah \textit{compiler} bahasa C, vcpkg (untuk Windows), serta dua buah \textit{library} umum yang telah didaftarkan di subbab \ref{sec:testing-specs-software}, yaitu:

\begin{itemize}
	\item cURL, dan
	\item cmake.
\end{itemize}
\noindent
Perlu diperhatikan bahwa \textit{library} cURL perlu diinstal melalui vcpkg, untuk menghindari masalah kompatibilitas akibat versi cURL yang tidak sesuai dengan yang dibutuhkan. Penggunaan vcpkg akan menghindari terjadinya masalah ini karena seluruh \textit{library} di vcpkg selalu diperbarui ke versi terbarunya.

Adapun perkakas ini juga membutuhkan adanya \textit{package} tambahan yang spesifik untuk Linux, yaitu:

\begin{itemize}
	\item libcurl4-openssl-dev (\textit{library development} cURL), dan
	\item GNU Make (opsional).
\end{itemize}

Perkakas ini juga menggunakan \textit{library} cJSON, tetapi untuk alasan kompatibilitas antar Windows dan Linux, \textit{library} ini langsung diikutkan di dalam perkakasnya sendiri, sehingga tidak perlu diinstal oleh pengguna lagi.
\end{comment}

\subsubsection{Pembangunan}
\label{sec:testing-implementation-usage-build}

Untuk memakai perkakasnya sendiri, perkakas ini perlu dibangun terlebih dahulu. Berikut merupakan langkah-langkah yang perlu diambil untuk proses tersebut.

\begin{enumerate}
	\item Buka \textit{folder} ``build'' di dalam \textit{folder} perkakas.
	\item Buka \textit{terminal/command prompt} di dalam \textit{folder} tersebut.
	\item Sesuai dengan sistem operasi tempat perkakas akan digunakan, ketik dan jalankan perintah berikut di \textit{terminal}:
	
	\begin{itemize}
		\item Windows:
		\begin{verbatim}
cmake -DCMAKE_BUILD_TYPE:STRING=Release -DCMAKE_TOOLCHAIN_FILE="<direktori
file toolchain vcpkg>" -G "<compiler>" ../
		\end{verbatim}
	
		\item Linux:
		\begin{verbatim}
cmake ../
		\end{verbatim}
	\end{itemize}		

	Untuk apa yang harus menggantikan variabel \verb|<compiler>| dapat dilihat dengan perintah \verb|cmake --help|. Daftar \textit{compiler} yang didukung oleh cmake dapat dilihat di bagian \mbox{``Generators''}, dan pengguna tinggal menyesuaikan dengan \textit{compiler} yang telah diinstal sebelumnya.  Ada beberapa hal yang perlu dijelaskan/diperhatikan untuk langkah ini.
	
	\begin{itemize}
		\item Windows
			
		\begin{itemize}
			\item Opsi \verb|-DMAKE_TOOLCHAIN_FILE| merupakan metode pengintegrasian vcpkg untuk proyek CMake. Untuk direktori persisnya (dan sintaks lengkap dari opsi ini) dapat dilihat setelah langkah ``Using vcpkg with MSBuild/Visual Studio'' di halaman panduan instalasi vcpkg.\footnote{\href{https://vcpkg.io/en/getting-started.html}{Getting started with vcpkg}}
			\item Direkomendasikan untuk menginstal \textit{compiler} \textbf{MinGW}, karena \textit{compiler} ini sudah mengikutkan salah satu file \textit{header} yang dibutuhkan oleh perkakas ini. Apabila pengguna menggunakan \textit{compiler} ini, variabel \verb|<compiler>| harus diisi dengan ``\verb|MinGW Makefiles|''.
			\item \textbf{Jangan menggunakan \textit{compiler} Visual Studio}, karena \textit{compiler} ini tidak mengandung file \textit{header} C yang dibutuhkan di perkakas ini. Perlu diperhatikan juga bahwa compiler Visual Studio ini merupakan nilai \textit{default} dari \verb|<compiler>| untuk sistem operasi Windows, jadi pengguna juga tidak boleh menghilangkan opsi \verb|-G| tersebut begitu saja.
		\end{itemize}
			
		\item Linux \\
		Untuk sistem operasi berbasis Linux, tidak perlu mengatur \textit{compiler}, karena nilai \textit{default} dari variabel \verb|<compiler>| di sistem operasi berbasis Linux (\textbf{Unix Makefiles}) sudah ideal.
	\end{itemize}
	
	\item Ketik dan jalankan perintah berikut:
	\begin{verbatim}
cmake --build .
	\end{verbatim}
	Bagi pengguna sistem operasi berbasis Linux, perintah di langkah ini dapat digantikan dengan perintah berikut:
	\begin{verbatim}
sudo make install
	\end{verbatim}
	Perintah alternatif ini akan menghasilkan hasil yang sama. Perlu diperhatikan bahwa jika pengguna ingin menginstal perkakas melalui, pengguna perlu menginstal \textbf{GNU Make} terlebih dahulu.
	
	\item Khusus sistem operasi berbasis \textbf{Linux}, jika pengguna \textbf{tidak} menggunakan perintah \verb|make|, ketik dan jalankan perintah berikut pula untuk menginstal file-file tambahan:
		\begin{verbatim}
sudo cmake --install .
	\end{verbatim}
	\item File \textit{executable} akan terletak di dalam \textit{folder} ``build'', dan siap dijalankan.
\end{enumerate}

\subsection{Pengujian}
\label{sec:testing-experiments}